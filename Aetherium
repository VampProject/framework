local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local Library = {}

local function MakeDraggable(Frame, DragHandle)
    DragHandle.Active = true
    local Dragging, DragInput, DragStart, StartPos

    DragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = input.Position
            StartPos = Frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)

    DragHandle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if Dragging and input == DragInput then
            local delta = input.Position - DragStart
            local newPos = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + delta.X, StartPos.Y.Scale, StartPos.Y.Offset + delta.Y)
            TweenService:Create(Frame, TweenInfo.new(0.05), {Position = newPos}):Play()
        end
    end)
end

-- Tema visual
local THEME = {
    Background = Color3.fromRGB(15, 15, 15), -- Onyx #0F0F0F
    Topbar = Color3.fromRGB(28, 28, 32),
    ElementBackground = Color3.fromRGB(26, 26, 26), -- #1A1A1A
    TextColor = Color3.fromRGB(255, 255, 255),
    ButtonTextColor = Color3.fromRGB(255, 255, 255),
    TextDim = Color3.fromRGB(150, 150, 150),
    Accent = Color3.fromRGB(0, 122, 255), -- Electric Blue
    Accent2 = Color3.fromRGB(50, 150, 255),
    Stroke = Color3.fromRGB(35, 35, 35),
    CornerRadius = UDim.new(0, 6)
}

function Library:CreateWindow(Config)
    local Title = Config.Title or "UI Library"
    local CleanupActions = {}

    -- Apply custom theme if provided
    if Config.Theme then
        for k, v in pairs(Config.Theme) do
            THEME[k] = v
        end
    end

    -- Game Lock / PlaceId Check
    if Config.PlaceId and type(Config.PlaceId) == "number" and Config.PlaceId > 0 then
        if game.PlaceId ~= Config.PlaceId then
            local ErrorGui = Instance.new("ScreenGui")
            ErrorGui.Name = "ErrorUI"
            ErrorGui.ResetOnSpawn = false
            pcall(function() ErrorGui.Parent = game:GetService("CoreGui") end)
            if not ErrorGui.Parent then ErrorGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

            local ErrorFrame = Instance.new("Frame")
            ErrorFrame.Size = UDim2.new(0, 400, 0, 240)
            ErrorFrame.Position = UDim2.new(0.5, -200, 0.5, -120)
            ErrorFrame.BackgroundColor3 = THEME.Background
            ErrorFrame.BorderSizePixel = 0
            ErrorFrame.Parent = ErrorGui

            local ErrorCorner = Instance.new("UICorner")
            ErrorCorner.CornerRadius = UDim.new(0, 10)
            ErrorCorner.Parent = ErrorFrame

            local ErrorStroke = Instance.new("UIStroke")
            ErrorStroke.Thickness = 2
            ErrorStroke.Parent = ErrorFrame

            local StrokeGrad = Instance.new("UIGradient")
            StrokeGrad.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 60, 60)),
                ColorSequenceKeypoint.new(1, THEME.Accent)
            }
            StrokeGrad.Rotation = 45
            StrokeGrad.Parent = ErrorStroke

            local Icon = Instance.new("ImageLabel")
            Icon.Size = UDim2.new(0, 60, 0, 60)
            Icon.Position = UDim2.new(0.5, -30, 0.12, 0)
            Icon.BackgroundTransparency = 1
            Icon.Image = "rbxassetid://114509698380342" -- Aetherium Logo
            Icon.Parent = ErrorFrame

            local Title = Instance.new("TextLabel")
            Title.Text = "Incorrect Game"
            Title.Font = Enum.Font.GothamBold
            Title.TextSize = 22
            Title.TextColor3 = THEME.TextColor
            Title.Size = UDim2.new(1, 0, 0, 30)
            Title.Position = UDim2.new(0, 0, 0.42, 0)
            Title.BackgroundTransparency = 1
            Title.Parent = ErrorFrame

            local Desc = Instance.new("TextLabel")
            Desc.Text = "This script is locked to a specific game.\nPlease join the correct game to use it."
            Desc.Font = Enum.Font.Gotham
            Desc.TextSize = 14
            Desc.TextColor3 = THEME.TextDim
            Desc.Size = UDim2.new(0.9, 0, 0, 40)
            Desc.Position = UDim2.new(0.05, 0, 0.58, 0)
            Desc.BackgroundTransparency = 1
            Desc.TextWrapped = true
            Desc.Parent = ErrorFrame

            local CloseBtn = Instance.new("TextButton")
            CloseBtn.Size = UDim2.new(0.4, 0, 0, 35)
            CloseBtn.Position = UDim2.new(0.3, 0, 0.8, 0)
            CloseBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            CloseBtn.Text = "Close"
            CloseBtn.TextColor3 = Color3.new(1,1,1)
            CloseBtn.Font = Enum.Font.GothamBold
            CloseBtn.TextSize = 14
            CloseBtn.Parent = ErrorFrame
            Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0, 6)
            
            CloseBtn.MouseButton1Click:Connect(function() ErrorGui:Destroy() end)

            local DummyWindow = {}
            function DummyWindow:Tab() return {Button=function()end,Toggle=function()end,Slider=function()end,Dropdown=function()end,Label=function()end} end
            function DummyWindow:Notification() end
            return DummyWindow
        end
    end

    -- ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ModernUI_" .. math.random(1000, 9999)
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    -- Intentar poner en CoreGui (útil en exploits), fallback a PlayerGui
    local success = pcall(function()
        ScreenGui.Parent = game:GetService("CoreGui")
    end)
    if not success then
        ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end

    -- Ventana principal
    MainFrame.Size = UDim2.new(0, 550, 0, 350)
    MainFrame.Position = UDim2.new(0.5, -275, 0.5, -175)
    MainFrame.BackgroundTransparency = 1
    MainFrame.BorderSizePixel = 0
    MainFrame.GroupTransparency = 0
    MainFrame.Visible = true -- Hidden until KeySystem/Init

    -- Background
    local Bg = Instance.new("Frame")
    Bg.Name = "Bg"
    Bg.Size = UDim2.new(1, 0, 1, 0)
    Bg.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Bg.BorderSizePixel = 0
    Bg.ClipsDescendants = true
    Bg.Parent = MainFrame

    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = THEME.CornerRadius
    MainCorner.Parent = Bg

    local BgGradient = Instance.new("UIGradient")
    BgGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 50)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 30))
    }
    BgGradient.Rotation = 90
    BgGradient.Parent = Bg

    local Pattern = Instance.new("ImageLabel")
    Pattern.Name = "Pattern"
    Pattern.Size = UDim2.new(1, 0, 1, 0)
    Pattern.BackgroundTransparency = 1
    Pattern.Image = "rbxassetid://2151741365"
    Pattern.ImageTransparency = 0.92
    Pattern.ScaleType = Enum.ScaleType.Tile
    Pattern.TileSize = UDim2.new(0, 100, 0, 100)
    Pattern.Parent = Bg

    local MainStroke = Instance.new("UIStroke")
    MainStroke.Thickness = 1
    MainStroke.Color = THEME.Stroke
    MainStroke.Parent = Bg

    local StrokeGradient = Instance.new("UIGradient")
    StrokeGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 80, 85)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 35))
    }
    StrokeGradient.Rotation = 45
    StrokeGradient.Parent = MainStroke

    -- Particulas Menu Principal (Background)
    task.spawn(function()
        while Bg.Parent do
            local Particle = Instance.new("ImageLabel")
            Particle.Size = UDim2.new(0, math.random(4, 8), 0, math.random(4, 8))
            Particle.Position = UDim2.new(math.random(0, 100)/100, 0, 1, 0)
            Particle.BackgroundTransparency = 1
            Particle.Image = "rbxassetid://8539427585" -- Triangle
            Particle.ImageColor3 = Color3.new(1, 1, 1)
            Particle.ImageTransparency = 0.8
            Particle.Rotation = math.random(0, 360)
            Particle.ZIndex = 0
            Particle.Parent = Bg
            
            local duration = math.random(5, 10)
            TweenService:Create(Particle, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
                Position = UDim2.new(Particle.Position.X.Scale, 0, -0.1, 0),
                ImageTransparency = 1,
                Rotation = Particle.Rotation + math.random(-90, 90)
            }):Play()
            
            task.delay(duration, function() Particle:Destroy() end)
            task.wait(0.5)
        end
    end)

    -- Topbar
    local Topbar = Instance.new("Frame")
    Topbar.Name = "Topbar"
    Topbar.Size = UDim2.new(1, 0, 0, 40)
    Topbar.BackgroundColor3 = THEME.Topbar
    Topbar.BorderSizePixel = 0
    Topbar.Parent = Bg

    MakeDraggable(MainFrame, Topbar)

    local Separator = Instance.new("Frame")
    Separator.Name = "Separator"
    Separator.Size = UDim2.new(1, 0, 0, 1)
    Separator.Position = UDim2.new(0, 0, 1, 0)
    Separator.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Separator.BorderSizePixel = 0
    Separator.ZIndex = 5
    Separator.Parent = Topbar

    local Icon = Instance.new("ImageLabel")
    Icon.Name = "Icon"
    Icon.Size = UDim2.new(0, 38, 0, 38)
    Icon.Position = UDim2.new(0, 10, 0.5, -19)
    Icon.BackgroundTransparency = 1
    Icon.Image = "rbxassetid://114509698380342"
    Icon.Parent = Topbar

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Text = Title
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 16
    TitleLabel.TextColor3 = THEME.TextColor
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Size = UDim2.new(1, -100, 1, 0)
    TitleLabel.Position = UDim2.new(0, 50, 0, 0)
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Topbar

    -- Botones de control (cerrar/minimizar)
    local function createControlBtn(color, offset)
        local btn = Instance.new("TextButton")
        btn.Text = ""
        btn.BackgroundColor3 = color
        btn.Size = UDim2.new(0, 16, 0, 16)
        btn.Position = UDim2.new(1, offset, 0.5, -8)
        btn.AutoButtonColor = false
        btn.BackgroundTransparency = 0
        btn.ZIndex = 20
        btn.Parent = Topbar

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(1, 0)
        corner.Parent = btn

        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundTransparency = 0.3}):Play()
        end)
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
        end)

        return btn
    end

    local CloseBtn = createControlBtn(Color3.fromRGB(255, 95, 87), -24) -- Mac Red
    local MinBtn = createControlBtn(Color3.fromRGB(255, 189, 46), -48) -- Mac Yellow
    local MaxBtn = createControlBtn(Color3.fromRGB(40, 201, 64), -72) -- Mac Green (Visual)

    local Maximized = false
    local DefaultSize = UDim2.new(0, 550, 0, 350)
    local MaxSize = UDim2.new(0, 800, 0, 500)

    MaxBtn.MouseButton1Click:Connect(function()
        Maximized = not Maximized
        local targetSize = Maximized and MaxSize or DefaultSize
        local targetPos = Maximized and UDim2.new(0.5, -400, 0.5, -250) or UDim2.new(0.5, -275, 0.5, -175)
        
        TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            Size = targetSize, Position = targetPos
        }):Play()
    end)

    -- Floating Widget
    local FloatingWidget = Instance.new("CanvasGroup")
    FloatingWidget.Name = "FloatingWidget"
    FloatingWidget.Size = UDim2.new(0, 220, 0, 36)
    FloatingWidget.Position = UDim2.new(0.1, 0, 0.1, 0)
    FloatingWidget.BackgroundColor3 = THEME.Background
    FloatingWidget.Visible = false
    FloatingWidget.GroupTransparency = 0
    FloatingWidget.Parent = ScreenGui

    local FloatingCorner = Instance.new("UICorner")
    FloatingCorner.CornerRadius = UDim.new(0, 8)
    FloatingCorner.Parent = FloatingWidget

    local FloatingStroke = Instance.new("UIStroke")
    FloatingStroke.Thickness = 1.5
    FloatingStroke.Color = Color3.fromRGB(255, 255, 255)
    FloatingStroke.Parent = FloatingWidget

    -- Aura (White Glow)
    local Aura = Instance.new("ImageLabel")
    Aura.Name = "Aura"
    Aura.Size = UDim2.new(1, 40, 1, 40)
    Aura.Position = UDim2.new(0.5, 0, 0.5, 0)
    Aura.AnchorPoint = Vector2.new(0.5, 0.5)
    Aura.BackgroundTransparency = 1
    Aura.ImageColor3 = Color3.new(1, 1, 1)
    Aura.ImageTransparency = 1
    Aura.ZIndex = 0
    Aura.Parent = FloatingWidget

    -- Triangle Particles
    task.spawn(function()
        while FloatingWidget.Parent do
            local Particle = Instance.new("ImageLabel")
            Particle.Size = UDim2.new(0, math.random(6, 10), 0, math.random(6, 10))
            Particle.Position = UDim2.new(math.random(10, 190)/200, 0, 1, 0)
            Particle.BackgroundTransparency = 1
            Particle.Image = "rbxassetid://8539427585" -- Triangle
            Particle.ImageColor3 = Color3.new(1, 1, 1)
            Particle.ImageTransparency = 0.4
            Particle.Rotation = math.random(0, 360)
            Particle.ZIndex = 0
            Particle.Parent = FloatingWidget
            
            local duration = math.random(15, 25) / 10
            TweenService:Create(Particle, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
                Position = UDim2.new(Particle.Position.X.Scale, 0, -0.8, 0),
                ImageTransparency = 1,
                Rotation = Particle.Rotation + math.random(-90, 90)
            }):Play()
            
            task.delay(duration, function() Particle:Destroy() end)
            task.wait(0.3)
        end
    end)

    local FloatingGradient = Instance.new("UIGradient")
    FloatingGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
        ColorSequenceKeypoint.new(0.5, Color3.new(0, 0, 0)),
        ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
    }
    FloatingGradient.Parent = FloatingStroke

    local FloatingIcon = Instance.new("ImageLabel")
    FloatingIcon.Name = "Icon"
    FloatingIcon.Size = UDim2.new(0, 20, 0, 20)
    FloatingIcon.Position = UDim2.new(0, 10, 0.5, -10)
    FloatingIcon.BackgroundTransparency = 1
    FloatingIcon.Image = "rbxassetid://114509698380342"
    FloatingIcon.Parent = FloatingWidget

    task.spawn(function()
        while FloatingWidget.Parent do
            FloatingGradient.Rotation = (FloatingGradient.Rotation + 1) % 360
            task.wait()
        end
    end)

    local FloatingTitle = Instance.new("TextLabel")
    FloatingTitle.Text = "Aetherium"
    FloatingTitle.Font = Enum.Font.GothamBold
    FloatingTitle.TextSize = 14
    FloatingTitle.TextColor3 = THEME.TextColor
    FloatingTitle.BackgroundTransparency = 1
    FloatingTitle.Size = UDim2.new(0, 100, 1, 0)
    FloatingTitle.Position = UDim2.new(0, 36, 0, 0)
    FloatingTitle.TextXAlignment = Enum.TextXAlignment.Left
    FloatingTitle.Parent = FloatingWidget

    local OpenBtn = Instance.new("TextButton")
    OpenBtn.Name = "OpenBtn"
    OpenBtn.Size = UDim2.new(0, 130, 1, 0)
    OpenBtn.Position = UDim2.new(0, 0, 0, 0)
    OpenBtn.BackgroundTransparency = 1
    OpenBtn.Text = ""
    OpenBtn.Parent = FloatingWidget

    local DragIcon = Instance.new("ImageLabel")
    DragIcon.Name = "DragIcon"
    DragIcon.Size = UDim2.new(0, 20, 0, 20)
    DragIcon.Position = UDim2.new(1, -26, 0.5, -10)
    DragIcon.BackgroundTransparency = 1
    DragIcon.Image = "rbxassetid://5172066892"
    DragIcon.ImageColor3 = THEME.TextDim
    DragIcon.Parent = FloatingWidget

    MakeDraggable(FloatingWidget, FloatingWidget)
    
    local SavedMainPos = MainFrame.Position

    local function ToggleMinimize()
        SavedMainPos = MainFrame.Position
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {GroupTransparency = 1}):Play()
        task.wait(0.3)
        MainFrame.Visible = false
        
        FloatingWidget.Visible = true
        FloatingWidget.GroupTransparency = 1
        FloatingWidget.Size = UDim2.new(0, 220, 0, 36)
        TweenService:Create(FloatingWidget, TweenInfo.new(0.3), {GroupTransparency = 0}):Play()
    end

    OpenBtn.MouseButton1Click:Connect(function()
        TweenService:Create(FloatingWidget, TweenInfo.new(0.3), {GroupTransparency = 1}):Play()
        task.wait(0.3)
        FloatingWidget.Visible = false
        
        MainFrame.Visible = true
        MainFrame.GroupTransparency = 1
        MainFrame.Size = UDim2.new(0, 550, 0, 350)
        MainFrame.Position = SavedMainPos
        TweenService:Create(MainFrame, TweenInfo.new(0.3), {GroupTransparency = 0}):Play()
    end)

    MinBtn.MouseButton1Click:Connect(ToggleMinimize)

    -- Contenedor de pestañas
    local TabContainer = Instance.new("CanvasGroup")
    TabContainer.Name = "TabContainer"
    TabContainer.Size = UDim2.new(1, -24, 0, 40)
    TabContainer.Position = UDim2.new(0, 12, 0, 45)
    TabContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 23)
    TabContainer.BackgroundTransparency = 0
    TabContainer.GroupTransparency = 0
    TabContainer.BorderSizePixel = 0
    TabContainer.ZIndex = 2
    TabContainer.Parent = MainFrame

    local TabContainerCorner = Instance.new("UICorner")
    TabContainerCorner.CornerRadius = UDim.new(0, 8)
    TabContainerCorner.Parent = TabContainer

    local TabContainerStroke = Instance.new("UIStroke")
    TabContainerStroke.Thickness = 1
    TabContainerStroke.Color = THEME.Stroke
    TabContainerStroke.Parent = TabContainer

    local TabContainerGradient = Instance.new("UIGradient")
    TabContainerGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 35)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 23))
    }
    TabContainerGradient.Rotation = 90
    TabContainerGradient.Parent = TabContainer

    local TabPad = Instance.new("UIPadding")
    TabPad.PaddingLeft = UDim.new(0, 4)
    TabPad.PaddingRight = UDim.new(0, 4)
    TabPad.PaddingTop = UDim.new(0, 4)
    TabPad.PaddingBottom = UDim.new(0, 4)
    TabPad.Parent = TabContainer

    local TabLayout = Instance.new("UIListLayout")
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabLayout.Padding = UDim.new(0, 8)
    TabLayout.Parent = TabContainer

    -- Contenedor de contenido
    local ContentContainer = Instance.new("CanvasGroup")
    ContentContainer.Name = "ContentContainer"
    ContentContainer.Size = UDim2.new(1, -24, 1, -95)
    ContentContainer.Position = UDim2.new(0, 12, 0, 90)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.GroupTransparency = 0
    ContentContainer.BorderSizePixel = 0
    ContentContainer.ZIndex = 2
    ContentContainer.Parent = MainFrame

    -- Notification Holder
    local NotificationHolder = Instance.new("Frame")
    NotificationHolder.Name = "NotificationHolder"
    NotificationHolder.Size = UDim2.new(0, 300, 1, 0)
    NotificationHolder.Position = UDim2.new(1, -320, 0, 0)
    NotificationHolder.BackgroundTransparency = 1
    NotificationHolder.Parent = ScreenGui

    local NotifList = Instance.new("UIListLayout")
    NotifList.SortOrder = Enum.SortOrder.LayoutOrder
    NotifList.VerticalAlignment = Enum.VerticalAlignment.Bottom
    NotifList.Padding = UDim.new(0, 10)
    NotifList.Parent = NotificationHolder

    local NotifPad = Instance.new("UIPadding")
    NotifPad.PaddingBottom = UDim.new(0, 20)
    NotifPad.Parent = NotificationHolder

    local Window = {}
    local FirstTab = true

    function Window:Tab(Name, Icon)
        -- Botón de pestaña
        local TabBtn = Instance.new("TextButton")
        TabBtn.Text = ""
        TabBtn.Font = Enum.Font.Gotham
        TabBtn.TextSize = 13
        TabBtn.TextColor3 = THEME.TextColor
        TabBtn.BackgroundColor3 = THEME.ElementBackground
        TabBtn.Size = UDim2.new(0, 0, 1, 0)
        TabBtn.AutomaticSize = Enum.AutomaticSize.X
        TabBtn.Parent = TabContainer

        local TabPad = Instance.new("UIPadding")
        TabPad.PaddingLeft = UDim.new(0, 12)
        TabPad.PaddingRight = UDim.new(0, 12)
        TabPad.Parent = TabBtn

        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(0, 4)
        TabCorner.Parent = TabBtn

        local TabStroke = Instance.new("UIStroke")
        TabStroke.Thickness = 1
        TabStroke.Color = THEME.Stroke
        TabStroke.Parent = TabBtn

        local TabLayout = Instance.new("UIListLayout")
        TabLayout.FillDirection = Enum.FillDirection.Horizontal
        TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        TabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        TabLayout.Padding = UDim.new(0, 6)
        TabLayout.Parent = TabBtn

        if Icon and Icon ~= "" then
            local TabIcon = Instance.new("ImageLabel")
            TabIcon.Name = "Icon"
            TabIcon.Size = UDim2.new(0, 16, 0, 16)
            TabIcon.BackgroundTransparency = 1
            TabIcon.Image = Icon
            TabIcon.ImageColor3 = THEME.TextColor
            TabIcon.Parent = TabBtn
        end

        local TabTitle = Instance.new("TextLabel")
        TabTitle.Name = "Title"
        TabTitle.Text = Name
        TabTitle.Font = Enum.Font.Gotham
        TabTitle.TextSize = 13
        TabTitle.TextColor3 = THEME.TextColor
        TabTitle.BackgroundTransparency = 1
        TabTitle.AutomaticSize = Enum.AutomaticSize.X
        TabTitle.Size = UDim2.new(0, 0, 1, 0)
        TabTitle.Parent = TabBtn

        -- Contenido de la pestaña
        local TabFrame = Instance.new("ScrollingFrame")
        TabFrame.Name = Name .. "Frame"
        TabFrame.Size = UDim2.new(1, 0, 1, 0)
        TabFrame.BackgroundTransparency = 1
        TabFrame.ScrollBarThickness = 2
        TabFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
        TabFrame.Visible = false
        TabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        TabFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
        TabFrame.Parent = ContentContainer

        local TabList = Instance.new("UIListLayout")
        TabList.SortOrder = Enum.SortOrder.LayoutOrder
        TabList.Padding = UDim.new(0, 6)
        TabList.Parent = TabFrame

        -- Primera pestaña activa por defecto
        if FirstTab then
            FirstTab = false
            TabFrame.Visible = true
            TabBtn.BackgroundColor3 = THEME.Accent
            TabStroke.Color = THEME.Accent
        end

        TabBtn.MouseButton1Click:Connect(function()
            if TabFrame.Visible then return end
            
            TweenService:Create(ContentContainer, TweenInfo.new(0.15), {GroupTransparency = 1}):Play()
            task.wait(0.1)
            
            for _, v in pairs(ContentContainer:GetChildren()) do
                if v:IsA("ScrollingFrame") then
                    v.Visible = false
                end
            end
            for _, v in pairs(TabContainer:GetChildren()) do
                if v:IsA("TextButton") then
                    TweenService:Create(v, TweenInfo.new(0.2), {BackgroundColor3 = THEME.ElementBackground}):Play()
                    TweenService:Create(v.UIStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
                    
                    local title = v:FindFirstChild("Title")
                    if title then TweenService:Create(title, TweenInfo.new(0.2), {TextColor3 = THEME.TextColor}):Play() end
                    local icon = v:FindFirstChild("Icon")
                    if icon then TweenService:Create(icon, TweenInfo.new(0.2), {ImageColor3 = THEME.TextColor}):Play() end
                end
            end
            TabFrame.Visible = true
            
            TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundColor3 = THEME.Accent}):Play()
            TweenService:Create(TabStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            
            local title = TabBtn:FindFirstChild("Title")
            if title then TweenService:Create(title, TweenInfo.new(0.2), {TextColor3 = THEME.TextColor}):Play() end
            local icon = TabBtn:FindFirstChild("Icon")
            if icon then TweenService:Create(icon, TweenInfo.new(0.2), {ImageColor3 = THEME.TextColor}):Play() end
            
            TweenService:Create(ContentContainer, TweenInfo.new(0.2), {GroupTransparency = 0}):Play()
        end)

        local TabObj = {}

        -- Botón
        function TabObj:Button(Text, Callback)
            local Button = Instance.new("TextButton")
            Button.Size = UDim2.new(1, 0, 0, 36)
            Button.BackgroundColor3 = THEME.ElementBackground
            Button.Text = Text
            Button.Font = Enum.Font.GothamMedium
            Button.TextColor3 = THEME.ButtonTextColor
            Button.TextSize = 14
            Button.AutoButtonColor = false
            Button.Parent = TabFrame

            local BtnCorner = Instance.new("UICorner")
            BtnCorner.CornerRadius = UDim.new(0, 4)
            BtnCorner.Parent = Button

            local BtnStroke = Instance.new("UIStroke")
            BtnStroke.Thickness = 1
            BtnStroke.Color = THEME.Stroke
            BtnStroke.Parent = Button

            local BtnGradient = Instance.new("UIGradient")
            BtnGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(210, 210, 210))
            }
            BtnGradient.Rotation = 90
            BtnGradient.Parent = Button

            Button.MouseEnter:Connect(function()
                TweenService:Create(BtnStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            end)
            Button.MouseLeave:Connect(function()
                TweenService:Create(BtnStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
            end)

            Button.MouseButton1Click:Connect(function()
                if Callback then pcall(Callback) end
            end)
        end

        -- Toggle
        function TabObj:Toggle(Text, Default, Callback)
            local Toggled = Default or false

            table.insert(CleanupActions, function()
                if Callback then pcall(Callback, false) end
            end)

            local ToggleBtn = Instance.new("TextButton")
            ToggleBtn.Size = UDim2.new(1, 0, 0, 36)
            ToggleBtn.BackgroundColor3 = THEME.ElementBackground
            ToggleBtn.Text = ""
            ToggleBtn.AutoButtonColor = false
            ToggleBtn.Parent = TabFrame

            local ToggleCorner = Instance.new("UICorner")
            ToggleCorner.CornerRadius = UDim.new(0, 4)
            ToggleCorner.Parent = ToggleBtn

            local ToggleGradient = Instance.new("UIGradient")
            ToggleGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(210, 210, 210))
            }
            ToggleGradient.Rotation = 90
            ToggleGradient.Parent = ToggleBtn

            local Label = Instance.new("TextLabel")
            Label.Text = Text
            Label.Font = Enum.Font.Gotham
            Label.TextColor3 = THEME.TextColor
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Parent = ToggleBtn

            local Switch = Instance.new("Frame")
            Switch.Size = UDim2.new(0, 44, 0, 22)
            Switch.Position = UDim2.new(1, -54, 0.5, -11)
            Switch.BackgroundColor3 = Toggled and THEME.Accent or Color3.fromRGB(60, 60, 60)
            Switch.Parent = ToggleBtn

            local SwitchCorner = Instance.new("UICorner")
            SwitchCorner.CornerRadius = UDim.new(1, 0)
            SwitchCorner.Parent = Switch

            local Circle = Instance.new("Frame")
            Circle.Size = UDim2.new(0, 16, 0, 16)
            Circle.Position = Toggled and UDim2.new(1, -19, 0.5, -8) or UDim2.new(0, 3, 0.5, -8)
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.Parent = Switch

            local CircleCorner = Instance.new("UICorner")
            CircleCorner.CornerRadius = UDim.new(1, 0)
            CircleCorner.Parent = Circle

            local ToggleStroke = Instance.new("UIStroke")
            ToggleStroke.Thickness = 1
            ToggleStroke.Color = THEME.Stroke
            ToggleStroke.Parent = ToggleBtn

            ToggleBtn.MouseEnter:Connect(function()
                TweenService:Create(ToggleStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            end)
            ToggleBtn.MouseLeave:Connect(function()
                TweenService:Create(ToggleStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
            end)

            ToggleBtn.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                if Callback then pcall(Callback, Toggled) end

                if Toggled then
                    TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = THEME.Accent}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2), {Position = UDim2.new(1, -19, 0.5, -8)}):Play()
                else
                    TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2), {Position = UDim2.new(0, 3, 0.5, -8)}):Play()
                end
            end)
        end

        -- Slider
        function TabObj:Slider(Text, Min, Max, Default, Callback)
            local Value = Default or Min

            table.insert(CleanupActions, function()
                if Callback then pcall(Callback, Default or Min) end
            end)

            local SliderBtn = Instance.new("TextButton")
            SliderBtn.Size = UDim2.new(1, 0, 0, 50)
            SliderBtn.BackgroundColor3 = THEME.ElementBackground
            SliderBtn.Text = ""
            SliderBtn.AutoButtonColor = false
            SliderBtn.Parent = TabFrame

            local SliderCorner = Instance.new("UICorner")
            SliderCorner.CornerRadius = UDim.new(0, 4)
            SliderCorner.Parent = SliderBtn

            local SliderGradient = Instance.new("UIGradient")
            SliderGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(210, 210, 210))
            }
            SliderGradient.Rotation = 90
            SliderGradient.Parent = SliderBtn

            local Label = Instance.new("TextLabel")
            Label.Text = Text
            Label.Font = Enum.Font.GothamMedium
            Label.TextColor3 = THEME.TextColor
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(1, -24, 0, 20)
            Label.Position = UDim2.new(0, 12, 0, 6)
            Label.Parent = SliderBtn

            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Text = tostring(Value)
            ValueLabel.Font = Enum.Font.Gotham
            ValueLabel.TextColor3 = THEME.TextColor
            ValueLabel.TextSize = 14
            ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Size = UDim2.new(1, -24, 0, 20)
            ValueLabel.Position = UDim2.new(0, 12, 0, 6)
            ValueLabel.Parent = SliderBtn

            local SliderBar = Instance.new("Frame")
            SliderBar.Size = UDim2.new(1, -24, 0, 6)
            SliderBar.Position = UDim2.new(0, 12, 0, 36)
            SliderBar.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            SliderBar.Parent = SliderBtn

            local BarCorner = Instance.new("UICorner")
            BarCorner.CornerRadius = UDim.new(1, 0)
            BarCorner.Parent = SliderBar

            local Fill = Instance.new("Frame")
            Fill.Size = UDim2.new((Value - Min) / (Max - Min), 0, 1, 0)
            Fill.BackgroundColor3 = THEME.Accent
            Fill.Parent = SliderBar

            local FillCorner = Instance.new("UICorner")
            FillCorner.CornerRadius = UDim.new(1, 0)
            FillCorner.Parent = Fill

            local FillGradient = Instance.new("UIGradient")
            FillGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, THEME.Accent),
                ColorSequenceKeypoint.new(1, THEME.Accent2)
            }
            FillGradient.Parent = Fill

            local SliderStroke = Instance.new("UIStroke")
            SliderStroke.Thickness = 1
            SliderStroke.Color = THEME.Stroke
            SliderStroke.Parent = SliderBtn

            SliderBtn.MouseEnter:Connect(function()
                TweenService:Create(SliderStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            end)
            SliderBtn.MouseLeave:Connect(function()
                TweenService:Create(SliderStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
            end)

            local IsDragging = false

            local function updateValue(input)
                local relX = math.clamp((input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                local newValue = math.floor(Min + (Max - Min) * relX)
                if newValue ~= Value then
                    Value = newValue
                    ValueLabel.Text = tostring(Value)
                    TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(relX, 0, 1, 0)}):Play()
                    if Callback then pcall(Callback, Value) end
                end
            end

            SliderBtn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = true
                    updateValue(input)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    updateValue(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = false
                end
            end)
        end

        -- Dropdown
        function TabObj:Dropdown(Text, Options, Default, Callback)
            local Expanded = false
            local Selected = Default or Options[1]

            local DropdownFrame = Instance.new("Frame")
            DropdownFrame.Size = UDim2.new(1, 0, 0, 36)
            DropdownFrame.BackgroundColor3 = THEME.ElementBackground
            DropdownFrame.ClipsDescendants = true
            DropdownFrame.Parent = TabFrame

            local DropCorner = Instance.new("UICorner")
            DropCorner.CornerRadius = UDim.new(0, 4)
            DropCorner.Parent = DropdownFrame

            local DropGradient = Instance.new("UIGradient")
            DropGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(210, 210, 210))
            }
            DropGradient.Rotation = 90
            DropGradient.Parent = DropdownFrame

            local DropStroke = Instance.new("UIStroke")
            DropStroke.Thickness = 1
            DropStroke.Color = THEME.Stroke
            DropStroke.Parent = DropdownFrame

            local DropBtn = Instance.new("TextButton")
            DropBtn.Size = UDim2.new(1, 0, 0, 36)
            DropBtn.BackgroundTransparency = 1
            DropBtn.Text = ""
            DropBtn.Parent = DropdownFrame

            local Label = Instance.new("TextLabel")
            Label.Text = Text
            Label.Font = Enum.Font.GothamMedium
            Label.TextColor3 = THEME.TextColor
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Parent = DropBtn

            local SelectedLabel = Instance.new("TextLabel")
            SelectedLabel.Text = Selected
            SelectedLabel.Font = Enum.Font.Gotham
            SelectedLabel.TextColor3 = THEME.TextColor
            SelectedLabel.TextSize = 14
            SelectedLabel.TextXAlignment = Enum.TextXAlignment.Right
            SelectedLabel.BackgroundTransparency = 1
            SelectedLabel.Size = UDim2.new(1, -60, 1, 0)
            SelectedLabel.Position = UDim2.new(0, 12, 0, 0)
            SelectedLabel.Parent = DropBtn

            local Arrow = Instance.new("ImageLabel")
            Arrow.Image = "rbxassetid://6031091004" -- Flecha hacia abajo
            Arrow.Size = UDim2.new(0, 20, 0, 20)
            Arrow.Position = UDim2.new(1, -32, 0.5, -10)
            Arrow.BackgroundTransparency = 1
            Arrow.Rotation = 0
            Arrow.Parent = DropBtn

            local OptionList = Instance.new("Frame")
            OptionList.Size = UDim2.new(1, 0, 0, 0)
            OptionList.Position = UDim2.new(0, 0, 0, 36)
            OptionList.BackgroundTransparency = 1
            OptionList.Parent = DropdownFrame

            local ListLayout = Instance.new("UIListLayout")
            ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            ListLayout.Parent = OptionList

            DropBtn.MouseEnter:Connect(function()
                TweenService:Create(DropStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            end)
            DropBtn.MouseLeave:Connect(function()
                TweenService:Create(DropStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
            end)

            local function RefreshList(NewOptions)
                for _, v in pairs(OptionList:GetChildren()) do
                    if v:IsA("TextButton") then v:Destroy() end
                end
                
                for _, option in ipairs(NewOptions) do
                    local OptBtn = Instance.new("TextButton")
                    OptBtn.Size = UDim2.new(1, 0, 0, 30)
                    OptBtn.BackgroundColor3 = THEME.ElementBackground
                    OptBtn.Text = option
                    OptBtn.Font = Enum.Font.Gotham
                    OptBtn.TextColor3 = THEME.TextColor
                    OptBtn.TextSize = 14
                    OptBtn.TextXAlignment = Enum.TextXAlignment.Left
                    OptBtn.Parent = OptionList

                    local OptPad = Instance.new("UIPadding")
                    OptPad.PaddingLeft = UDim.new(0, 12)
                    OptPad.Parent = OptBtn

                    OptBtn.MouseEnter:Connect(function()
                        TweenService:Create(OptBtn, TweenInfo.new(0.2), {
                            BackgroundColor3 = Color3.fromRGB(45, 45, 45),
                            TextColor3 = THEME.TextColor
                        }):Play()
                    end)
                    OptBtn.MouseLeave:Connect(function()
                        TweenService:Create(OptBtn, TweenInfo.new(0.2), {
                            BackgroundColor3 = THEME.ElementBackground,
                            TextColor3 = THEME.TextColor
                        }):Play()
                    end)

                    OptBtn.MouseButton1Click:Connect(function()
                        Selected = option
                        SelectedLabel.Text = Selected
                        if Callback then pcall(Callback, Selected) end
                        Expanded = false
                        TweenService:Create(DropdownFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 36)}):Play()
                        TweenService:Create(Arrow, TweenInfo.new(0.3), {Rotation = 0}):Play()
                    end)
                end
            end

            RefreshList(Options)

            DropBtn.MouseButton1Click:Connect(function()
                Expanded = not Expanded
                local targetHeight = Expanded and (36 + (#Options * 30)) or 36
                TweenService:Create(DropdownFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, targetHeight)}):Play()
                TweenService:Create(Arrow, TweenInfo.new(0.3), {Rotation = Expanded and 180 or 0}):Play()
            end)

            local DropdownMethods = {}
            function DropdownMethods:Refresh(NewOptions, NewDefault)
                Options = NewOptions
                RefreshList(Options)
                if NewDefault then
                    Selected = NewDefault
                    SelectedLabel.Text = Selected
                elseif not table.find(Options, Selected) then
                    Selected = Options[1] or "None"
                    SelectedLabel.Text = Selected
                end
                
                if Expanded then
                    local targetHeight = 36 + (#Options * 30)
                    TweenService:Create(DropdownFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, targetHeight)}):Play()
                end
            end
            
            return DropdownMethods
        end

        -- Label
        function TabObj:Label(Text)
            local Label = Instance.new("TextLabel")
            Label.Text = Text
            Label.Font = Enum.Font.Gotham
            Label.TextColor3 = THEME.TextColor
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(1, -24, 0, 0)
            Label.AutomaticSize = Enum.AutomaticSize.Y
            Label.TextWrapped = true
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.Parent = TabFrame
            
            local LabelPad = Instance.new("UIPadding")
            LabelPad.PaddingLeft = UDim.new(0, 12)
            LabelPad.PaddingRight = UDim.new(0, 12)
            LabelPad.PaddingTop = UDim.new(0, 6)
            LabelPad.PaddingBottom = UDim.new(0, 6)
            LabelPad.Parent = Label

            local LabelMethods = {}
            function LabelMethods:SetText(NewText)
                Label.Text = NewText
            end
            return LabelMethods
        end

        -- Separator
        function TabObj:Separator()
            local SeparatorFrame = Instance.new("Frame")
            SeparatorFrame.Size = UDim2.new(1, 0, 0, 16)
            SeparatorFrame.BackgroundTransparency = 1
            SeparatorFrame.Parent = TabFrame

            local Line = Instance.new("Frame")
            Line.Size = UDim2.new(1, 0, 0, 1)
            Line.Position = UDim2.new(0, 0, 0.5, 0)
            Line.BackgroundColor3 = THEME.Accent
            Line.BorderSizePixel = 0
            Line.Parent = SeparatorFrame
        end

        return TabObj
    end

    function Window:Notification(Title, Content, Duration, Icon)
        local Notif = Instance.new("Frame")
        Notif.Name = "Notification"
        Notif.Size = UDim2.new(1, 0, 0, 0) -- Start small
        Notif.BackgroundColor3 = THEME.ElementBackground
        Notif.BorderSizePixel = 0
        Notif.ClipsDescendants = true
        Notif.Parent = NotificationHolder

        local NotifCorner = Instance.new("UICorner")
        NotifCorner.CornerRadius = UDim.new(0, 6)
        NotifCorner.Parent = Notif

        local NotifStroke = Instance.new("UIStroke")
        NotifStroke.Thickness = 1
        NotifStroke.Color = THEME.Stroke
        NotifStroke.Parent = Notif

        local TextX = 10
        if Icon then
            local IconImg = Instance.new("ImageLabel")
            IconImg.Size = UDim2.new(0, 32, 0, 32)
            IconImg.Position = UDim2.new(0, 10, 0.5, -16)
            IconImg.BackgroundTransparency = 1
            IconImg.Image = Icon
            IconImg.Parent = Notif
            
            local IconCorner = Instance.new("UICorner")
            IconCorner.CornerRadius = UDim.new(1, 0)
            IconCorner.Parent = IconImg
            
            TextX = 50
        end

        local NotifTitle = Instance.new("TextLabel")
        NotifTitle.Text = Title
        NotifTitle.Font = Enum.Font.GothamBold
        NotifTitle.TextColor3 = THEME.TextColor
        NotifTitle.TextSize = 14
        NotifTitle.TextXAlignment = Enum.TextXAlignment.Left
        NotifTitle.BackgroundTransparency = 1
        NotifTitle.Size = UDim2.new(1, -TextX - 10, 0, 20)
        NotifTitle.Position = UDim2.new(0, TextX, 0, 10)
        NotifTitle.Parent = Notif

        local NotifContent = Instance.new("TextLabel")
        NotifContent.Text = Content
        NotifContent.Font = Enum.Font.Gotham
        NotifContent.TextColor3 = THEME.TextDim
        NotifContent.TextSize = 13
        NotifContent.TextXAlignment = Enum.TextXAlignment.Left
        NotifContent.TextWrapped = true
        NotifContent.BackgroundTransparency = 1
        NotifContent.Size = UDim2.new(1, -TextX - 10, 0, 30)
        NotifContent.Position = UDim2.new(0, TextX, 0, 30)
        NotifContent.Parent = Notif

        -- Animation
        TweenService:Create(Notif, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, 70)}):Play()
        
        task.delay(Duration or 3, function()
            TweenService:Create(Notif, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            task.wait(0.3)
            Notif:Destroy()
        end)
    end

    CloseBtn.MouseButton1Click:Connect(function()
        -- Reset values (Options off, Sliders default)
        for _, action in ipairs(CleanupActions) do
            task.spawn(action)
        end
        
        MainFrame.Visible = false
        FloatingWidget.Visible = false
        
        Window:Notification("Goodbye", "Thanks for using Aetherium! Join our Discord for more scripts.", 3)
        
        task.delay(3, function()
            ScreenGui:Destroy()
        end)
    end)

    -- Key System Logic
    local function ShowKeySystem()
        MainFrame.Visible = false -- Ocultar UI principal mientras se valida
        
        local Dimmer = Instance.new("Frame")
        Dimmer.Name = "KeySystemDimmer"
        Dimmer.Size = UDim2.new(1, 0, 1, 0)
        Dimmer.BackgroundColor3 = Color3.new(0, 0, 0)
        Dimmer.BackgroundTransparency = 1
        Dimmer.ZIndex = 9999
        Dimmer.Parent = ScreenGui

        -- Blur Effect
        local BlurEffect = Instance.new("BlurEffect")
        BlurEffect.Size = 0
        BlurEffect.Parent = game.Lighting
        TweenService:Create(BlurEffect, TweenInfo.new(0.5), {Size = 15}):Play()

        local KeyFrame = Instance.new("Frame")
        KeyFrame.Name = "KeyFrame"
        KeyFrame.Size = UDim2.new(0, 450, 0, 300)
        KeyFrame.Position = UDim2.new(0.5, -225, 0.5, -150)
        KeyFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
        KeyFrame.BorderSizePixel = 0
        KeyFrame.ClipsDescendants = true
        KeyFrame.BackgroundTransparency = 1
        KeyFrame.Parent = Dimmer

        -- macOS Window Background with Gradient
        local WindowBg = Instance.new("Frame")
        WindowBg.Name = "WindowBackground"
        WindowBg.Size = UDim2.new(1, 0, 1, 0)
        WindowBg.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
        WindowBg.BorderSizePixel = 0
        WindowBg.ZIndex = 1
        WindowBg.Parent = KeyFrame

        local BgCorner = Instance.new("UICorner")
        BgCorner.CornerRadius = UDim.new(0, 12)
        BgCorner.Parent = WindowBg

        local BgGradient = Instance.new("UIGradient")
        BgGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 40)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(25, 25, 30)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 25))
        }
        BgGradient.Rotation = 135
        BgGradient.Parent = WindowBg

        -- Outer Shadow
        local Shadow = Instance.new("ImageLabel")
        Shadow.Name = "Shadow"
        Shadow.Size = UDim2.new(1, 40, 1, 40)
        Shadow.Position = UDim2.new(0, -20, 0, -20)
        Shadow.BackgroundTransparency = 1
        Shadow.Image = "rbxassetid://5554236805"
        Shadow.ImageColor3 = Color3.new(0, 0, 0)
        Shadow.ImageTransparency = 0.5
        Shadow.ScaleType = Enum.ScaleType.Slice
        Shadow.SliceCenter = Rect.new(23, 23, 277, 277)
        Shadow.ZIndex = 0
        Shadow.Parent = KeyFrame

        -- Animated Gradient Particles
        task.spawn(function()
            while KeyFrame.Parent do
                local Particle = Instance.new("Frame")
                Particle.Size = UDim2.new(0, math.random(80, 150), 0, math.random(80, 150))
                Particle.Position = UDim2.new(math.random(-20, 120)/100, 0, math.random(-20, 120)/100, 0)
                Particle.BackgroundColor3 = Color3.fromHSV(math.random(180, 260)/360, 0.6, 1)
                Particle.BackgroundTransparency = 0.92
                Particle.BorderSizePixel = 0
                Particle.ZIndex = 2
                Particle.Parent = WindowBg
                
                local Corner = Instance.new("UICorner")
                Corner.CornerRadius = UDim.new(1, 0)
                Corner.Parent = Particle
                
                local duration = math.random(30, 50) / 10
                TweenService:Create(Particle, TweenInfo.new(duration, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                    Position = UDim2.new(math.random(-20, 120)/100, 0, math.random(-20, 120)/100, 0),
                    BackgroundTransparency = 0.98,
                    Size = UDim2.new(0, math.random(100, 200), 0, math.random(100, 200))
                }):Play()
                
                task.delay(duration, function() Particle:Destroy() end)
                task.wait(1)
            end
        end)

        -- macOS Titlebar with Traffic Lights
        local Titlebar = Instance.new("Frame")
        Titlebar.Name = "Titlebar"
        Titlebar.Size = UDim2.new(1, 0, 0, 52)
        Titlebar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
        Titlebar.BackgroundTransparency = 0.3
        Titlebar.BorderSizePixel = 0
        Titlebar.ZIndex = 3
        Titlebar.Parent = KeyFrame

        local TitlebarCorner = Instance.new("UICorner")
        TitlebarCorner.CornerRadius = UDim.new(0, 12)
        TitlebarCorner.Parent = Titlebar

        local TitlebarGradient = Instance.new("UIGradient")
        TitlebarGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 45)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 35))
        }
        TitlebarGradient.Rotation = 90
        TitlebarGradient.Parent = Titlebar

        -- Titlebar Bottom Extension (to remove rounded bottom)
        local TitlebarExtension = Instance.new("Frame")
        TitlebarExtension.Size = UDim2.new(1, 0, 0, 12)
        TitlebarExtension.Position = UDim2.new(0, 0, 1, -12)
        TitlebarExtension.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        TitlebarExtension.BorderSizePixel = 0
        TitlebarExtension.ZIndex = 3
        TitlebarExtension.Parent = Titlebar

        local TitlebarDivider = Instance.new("Frame")
        TitlebarDivider.Size = UDim2.new(1, 0, 0, 1)
        TitlebarDivider.Position = UDim2.new(0, 0, 1, 0)
        TitlebarDivider.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
        TitlebarDivider.BackgroundTransparency = 0.5
        TitlebarDivider.BorderSizePixel = 0
        TitlebarDivider.ZIndex = 4
        TitlebarDivider.Parent = Titlebar

        -- Traffic Light Buttons (macOS style)
        local function CreateTrafficLight(color, position, onClick)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(0, 12, 0, 12)
            button.Position = position
            button.BackgroundColor3 = color
            button.Text = ""
            button.AutoButtonColor = false
            button.ZIndex = 5
            button.Parent = Titlebar
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(1, 0)
            corner.Parent = button
            
            local stroke = Instance.new("UIStroke")
            stroke.Thickness = 0.5
            stroke.Color = Color3.new(0, 0, 0)
            stroke.Transparency = 0.85
            stroke.Parent = button

            local icon = Instance.new("TextLabel")
            icon.Size = UDim2.new(1, 0, 1, 0)
            icon.BackgroundTransparency = 1
            icon.Text = ""
            icon.TextColor3 = Color3.fromRGB(80, 50, 50)
            icon.TextSize = 10
            icon.Font = Enum.Font.GothamBold
            icon.TextTransparency = 1
            icon.ZIndex = 6
            icon.Parent = button
            
            button.MouseEnter:Connect(function()
                TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(color.R * 255 * 0.85, color.G * 255 * 0.85, color.B * 255 * 0.85)}):Play()
                TweenService:Create(icon, TweenInfo.new(0.15), {TextTransparency = 0}):Play()
            end)
            
            button.MouseLeave:Connect(function()
                TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = color}):Play()
                TweenService:Create(icon, TweenInfo.new(0.15), {TextTransparency = 1}):Play()
            end)
            
            if onClick then
                button.MouseButton1Click:Connect(onClick)
            end
            
            return button, icon
        end

        local CloseBtn, CloseIcon = CreateTrafficLight(
            Color3.fromRGB(255, 95, 87),
            UDim2.new(0, 12, 0, 20),
            function()
                TweenService:Create(BlurEffect, TweenInfo.new(0.3), {Size = 0}):Play()
                TweenService:Create(Dimmer, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
                TweenService:Create(KeyFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0, 0, 0, 0)}):Play()
                task.wait(0.3)
                BlurEffect:Destroy()
                ScreenGui:Destroy()
            end
        )
        CloseIcon.Text = "×"
        CloseIcon.TextSize = 14

        local MinBtn, MinIcon = CreateTrafficLight(
            Color3.fromRGB(255, 189, 46),
            UDim2.new(0, 32, 0, 20)
        )
        MinIcon.Text = "−"
        MinIcon.TextSize = 16
        MinIcon.Position = UDim2.new(0, 0, 0, -2)

        local MaxBtn, MaxIcon = CreateTrafficLight(
            Color3.fromRGB(40, 201, 64),
            UDim2.new(0, 52, 0, 20)
        )
        MaxIcon.Text = "+"
        MaxIcon.TextSize = 12

        -- Title and Icon
        local TitleContainer = Instance.new("Frame")
        TitleContainer.Size = UDim2.new(0, 300, 1, 0)
        TitleContainer.Position = UDim2.new(0.5, -150, 0, 0)
        TitleContainer.BackgroundTransparency = 1
        TitleContainer.ZIndex = 5
        TitleContainer.Parent = Titlebar

        local TitleLayout = Instance.new("UIListLayout")
        TitleLayout.FillDirection = Enum.FillDirection.Horizontal
        TitleLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        TitleLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        TitleLayout.Padding = UDim.new(0, 10)
        TitleLayout.Parent = TitleContainer

        local HeaderIcon = Instance.new("ImageLabel")
        HeaderIcon.Size = UDim2.new(0, 24, 0, 24)
        HeaderIcon.Position = UDim2.new(0.5, -70, 0.5, -12)
        HeaderIcon.Size = UDim2.new(0, 32, 0, 32)
        HeaderIcon.BackgroundTransparency = 1
        HeaderIcon.Image = "rbxassetid://114509698380342"
        HeaderIcon.ZIndex = 5
        HeaderIcon.Parent = TitleContainer

        local HeaderTitle = Instance.new("TextLabel")
        HeaderTitle.Text = "Aetherium Key System"
        HeaderTitle.Font = Enum.Font.GothamMedium
        HeaderTitle.TextSize = 13
        HeaderTitle.Font = Enum.Font.GothamBold
        HeaderTitle.TextSize = 16
        HeaderTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
        HeaderTitle.Size = UDim2.new(0, 200, 1, 0)
        HeaderTitle.Position = UDim2.new(0.5, -55, 0, 0)
        HeaderTitle.TextXAlignment = Enum.TextXAlignment.Left
        HeaderTitle.Size = UDim2.new(0, 0, 1, 0)
        HeaderTitle.AutomaticSize = Enum.AutomaticSize.X
        HeaderTitle.BackgroundTransparency = 1
        HeaderTitle.ZIndex = 5
        HeaderTitle.Parent = TitleContainer

        MakeDraggable(KeyFrame, Titlebar)

        -- Content Section
        local Content = Instance.new("Frame")
        Content.Name = "Content"
        Content.Size = UDim2.new(1, -40, 1, -72)
        Content.Position = UDim2.new(0, 20, 0, 62)
        Content.BackgroundTransparency = 1
        Content.ZIndex = 3
        Content.Parent = KeyFrame

        -- Subtitle
        local Subtitle = Instance.new("TextLabel")
        Subtitle.Text = "Enter your access key to continue"
        Subtitle.Font = Enum.Font.Gotham
        Subtitle.TextSize = 12
        Subtitle.TextColor3 = Color3.fromRGB(180, 180, 180)
        Subtitle.Size = UDim2.new(1, 0, 0, 20)
        Subtitle.Position = UDim2.new(0, 0, 0, 0)
        Subtitle.TextXAlignment = Enum.TextXAlignment.Center
        Subtitle.BackgroundTransparency = 1
        Subtitle.ZIndex = 4
        Subtitle.Parent = Content

        -- Key Input with macOS styling
        local InputContainer = Instance.new("Frame")
        InputContainer.Size = UDim2.new(1, 0, 0, 48)
        InputContainer.Position = UDim2.new(0, 0, 0, 35)
        InputContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        InputContainer.BorderSizePixel = 0
        InputContainer.ZIndex = 4
        InputContainer.Parent = Content

        local InputCorner = Instance.new("UICorner")
        InputCorner.CornerRadius = UDim.new(0, 8)
        InputCorner.Parent = InputContainer

        local InputStroke = Instance.new("UIStroke")
        InputStroke.Thickness = 1
        InputStroke.Color = Color3.fromRGB(60, 60, 60)
        InputStroke.Transparency = 0
        InputStroke.Parent = InputContainer

        local InputShadow = Instance.new("Frame")
        InputShadow.Size = UDim2.new(1, 0, 0, 2)
        InputShadow.Position = UDim2.new(0, 0, 1, 0)
        InputShadow.BackgroundColor3 = Color3.new(0, 0, 0)
        InputShadow.BackgroundTransparency = 0.95
        InputShadow.BorderSizePixel = 0
        InputShadow.ZIndex = 3
        InputShadow.Parent = InputContainer

        local InputIcon = Instance.new("ImageLabel")
        InputIcon.Size = UDim2.new(0, 20, 0, 20)
        InputIcon.Position = UDim2.new(0, 12, 0.5, -10)
        InputIcon.BackgroundTransparency = 1
        InputIcon.Image = "rbxassetid://6031097225"
        InputIcon.ImageColor3 = Color3.fromRGB(150, 150, 150)
        InputIcon.ZIndex = 5
        InputIcon.Parent = InputContainer

        local KeyInput = Instance.new("TextBox")
        KeyInput.Size = UDim2.new(1, -20, 1, 0)
        KeyInput.Position = UDim2.new(0, 10, 0, 0)
        KeyInput.Size = UDim2.new(1, -50, 1, 0)
        KeyInput.Position = UDim2.new(0, 44, 0, 0)
        KeyInput.BackgroundTransparency = 1
        KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
        KeyInput.PlaceholderText = "Enter your key here..."
        KeyInput.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
        KeyInput.Font = Enum.Font.Gotham
        KeyInput.TextSize = 14
        KeyInput.TextXAlignment = Enum.TextXAlignment.Left
        KeyInput.ZIndex = 5
        KeyInput.Parent = InputContainer

        -- Focus animations
        KeyInput.Focused:Connect(function()
            TweenService:Create(InputStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(255, 255, 255), Thickness = 1.5}):Play()
            TweenService:Create(InputContainer, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
            TweenService:Create(InputIcon, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(255, 255, 255)}):Play()
        end)
        KeyInput.FocusLost:Connect(function()
            TweenService:Create(InputStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(60, 60, 60), Thickness = 1}):Play()
            TweenService:Create(InputIcon, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(150, 150, 150)}):Play()
        end)

        -- Buttons Container
        local ButtonsContainer = Instance.new("Frame")
        ButtonsContainer.Size = UDim2.new(1, 0, 0, 44)
        ButtonsContainer.Position = UDim2.new(0, 0, 0, 100)
        ButtonsContainer.BackgroundTransparency = 1
        ButtonsContainer.ZIndex = 4
        ButtonsContainer.Parent = Content

        -- Verify Button (Primary)
        local SubmitBtn = Instance.new("TextButton")
        SubmitBtn.Size = UDim2.new(0.48, 0, 1, 0)
        SubmitBtn.Position = UDim2.new(0.52, 0, 0, 0)
        SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 122, 255)
        SubmitBtn.Text = "Verify Key"
        SubmitBtn.Font = Enum.Font.GothamMedium
        SubmitBtn.TextColor3 = Color3.new(1, 1, 1)
        SubmitBtn.TextSize = 13
        SubmitBtn.AutoButtonColor = false
        SubmitBtn.ClipsDescendants = true
        SubmitBtn.ZIndex = 5
        SubmitBtn.Parent = ButtonsContainer

        local SubmitCorner = Instance.new("UICorner")
        SubmitCorner.CornerRadius = UDim.new(0, 8)
        SubmitCorner.Parent = SubmitBtn

        -- Button Shine Effect
        local Shine = Instance.new("Frame")
        Shine.Size = UDim2.new(0, 0, 2, 0)
        Shine.Position = UDim2.new(0, 0, -0.5, 0)
        Shine.BackgroundColor3 = Color3.new(1, 1, 1)
        Shine.BackgroundTransparency = 0.5
        Shine.BorderSizePixel = 0
        Shine.Rotation = 20
        Shine.ZIndex = 6
        Shine.Parent = SubmitBtn

        -- Progress Bar
        local ProgressBar = Instance.new("Frame")
        ProgressBar.Name = "ProgressBar"
        ProgressBar.Size = UDim2.new(0, 0, 1, 0)
        ProgressBar.BackgroundColor3 = Color3.new(1, 1, 1)
        ProgressBar.BackgroundTransparency = 0.7
        ProgressBar.BorderSizePixel = 0
        ProgressBar.ZIndex = 6
        ProgressBar.Parent = SubmitBtn

        SubmitBtn.MouseEnter:Connect(function()
            TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(10, 132, 255)}):Play()
        end)
        SubmitBtn.MouseLeave:Connect(function()
            TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 122, 255)}):Play()
        end)

        -- Get Key Button (Secondary)
        local GetKeyBtn = Instance.new("TextButton")
        GetKeyBtn.Size = UDim2.new(0.48, 0, 1, 0)
        GetKeyBtn.Position = UDim2.new(0, 0, 0, 0)
        GetKeyBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        GetKeyBtn.Text = "Get Key"
        GetKeyBtn.Font = Enum.Font.GothamMedium
        GetKeyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        GetKeyBtn.TextSize = 13
        GetKeyBtn.AutoButtonColor = false
        GetKeyBtn.ZIndex = 5
        GetKeyBtn.Parent = ButtonsContainer

        local GetKeyCorner = Instance.new("UICorner")
        GetKeyCorner.CornerRadius = UDim.new(0, 8)
        GetKeyCorner.Parent = GetKeyBtn

        local GetKeyStroke = Instance.new("UIStroke")
        GetKeyStroke.Thickness = 1
        GetKeyStroke.Color = Color3.fromRGB(60, 60, 60)
        GetKeyStroke.Transparency = 0.5
        GetKeyStroke.Parent = GetKeyBtn

        GetKeyBtn.MouseEnter:Connect(function()
            TweenService:Create(GetKeyBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
            TweenService:Create(GetKeyStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(255, 255, 255), Transparency = 0}):Play()
        end)
        GetKeyBtn.MouseLeave:Connect(function()
            TweenService:Create(GetKeyBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 45)}):Play()
            TweenService:Create(GetKeyStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(60, 60, 60), Transparency = 0.5}):Play()
        end)

        GetKeyBtn.MouseButton1Click:Connect(function()
            local link = Config.KeySettings.Discord ~= "" and Config.KeySettings.Discord or Config.KeySettings.Site
            if setclipboard then 
                setclipboard(link) 
                Window:Notification("System", "Link copied to clipboard", 2)
            end
            GetKeyBtn.Text = "✓ Copied!"
            task.wait(1.5)
            GetKeyBtn.Text = "Get Key"
        end)

        -- Check Key Function
        local isChecking = false

        local function CheckKey()
            if isChecking then return end
            isChecking = true
            
            local originalText = SubmitBtn.Text
            SubmitBtn.Text = "Verifying..."
            
            -- Shine animation
            TweenService:Create(Shine, TweenInfo.new(0.6, Enum.EasingStyle.Quad), {Position = UDim2.new(1, 0, -0.5, 0)}):Play()
            
            -- Progress Bar Animation
            ProgressBar.Size = UDim2.new(0, 0, 1, 0)
            local progressTween = TweenService:Create(ProgressBar, TweenInfo.new(1.2, Enum.EasingStyle.Quad), {Size = UDim2.new(1, 0, 1, 0)})
            progressTween:Play()
            
            task.wait(1.2)

            local Input = KeyInput.Text:gsub("%s+", "")
            local ValidKey = Config.KeySettings.Key
            
            if Config.KeySettings.GrabKeyFromSite then
                local s, r = pcall(function() return game:HttpGet(Config.KeySettings.Site) end)
                if s then 
                    ValidKey = r:gsub("[\n\r]", " "):gsub("%s+", "") 
                else
                    Window:Notification("Error", "Failed to fetch key from site", 3)
                    SubmitBtn.Text = "✗ Error"
                    SubmitBtn.BackgroundColor3 = Color3.fromRGB(255, 59, 48)
                    task.wait(1.5)
                    SubmitBtn.Text = originalText
                    SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 122, 255)
                    ProgressBar.Size = UDim2.new(0, 0, 1, 0)
                    Shine.Position = UDim2.new(0, 0, -0.5, 0)
                    isChecking = false
                    return
                end
            end

            if Input == ValidKey then
                SubmitBtn.Text = "✓ Success!"
                SubmitBtn.BackgroundColor3 = Color3.fromRGB(52, 199, 89)
                
                task.wait(0.4)
                
                TweenService:Create(BlurEffect, TweenInfo.new(0.4), {Size = 0}):Play()
                TweenService:Create(Dimmer, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
                TweenService:Create(KeyFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                    Size = UDim2.new(0, 0, 0, 0),
                    Position = UDim2.new(0.5, 0, 0.5, 0)
                }):Play()
                
                task.wait(0.4)
                BlurEffect:Destroy()
                Dimmer:Destroy()
                MainFrame.Visible = true
                
                local thumb = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
                Window:Notification("Welcome", "Logged in as " .. LocalPlayer.Name, 5, thumb)
            else
                SubmitBtn.Text = "✗ Invalid Key"
                SubmitBtn.BackgroundColor3 = Color3.fromRGB(255, 59, 48)
                
                -- Shake animation
                for i = 1, 3 do
                    TweenService:Create(KeyFrame, TweenInfo.new(0.05), {Position = UDim2.new(0.5, -235, 0.5, -150)}):Play()
                    task.wait(0.05)
                    TweenService:Create(KeyFrame, TweenInfo.new(0.05), {Position = UDim2.new(0.5, -215, 0.5, -150)}):Play()
                    task.wait(0.05)
                end
                TweenService:Create(KeyFrame, TweenInfo.new(0.1), {Position = UDim2.new(0.5, -225, 0.5, -150)}):Play()
                
                task.wait(1.5)
                SubmitBtn.Text = originalText
                SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 122, 255)
                ProgressBar.Size = UDim2.new(0, 0, 1, 0)
                Shine.Position = UDim2.new(0, 0, -0.5, 0)
                KeyInput.Text = ""
            end
            isChecking = false
        end

        SubmitBtn.MouseButton1Click:Connect(CheckKey)
        KeyInput.FocusLost:Connect(function(enterPressed)
            if enterPressed then CheckKey() end
        end)

        -- Entrance Animation
        KeyFrame.Size = UDim2.new(0, 0, 0, 0)
        KeyFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        task.wait(0.1)
        TweenService:Create(KeyFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 450, 0, 300),
            Position = UDim2.new(0.5, -225, 0.5, -150)
        }):Play()
        TweenService:Create(Dimmer, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
    end

    -- Init Sequence (Loading)
    local function InitSequence()
        MainFrame.Visible = true
        
        local LoadingFrame = Instance.new("Frame")
        LoadingFrame.Name = "LoadingFrame"
        LoadingFrame.Size = UDim2.new(1, 0, 1, 0)
        LoadingFrame.BackgroundColor3 = THEME.Background
        LoadingFrame.BorderSizePixel = 0
        LoadingFrame.ZIndex = 10
        LoadingFrame.Parent = MainFrame

        local LoadingCorner = Instance.new("UICorner")
        LoadingCorner.CornerRadius = THEME.CornerRadius
        LoadingCorner.Parent = LoadingFrame

        local LoadIcon = Instance.new("ImageLabel")
        LoadIcon.Name = "LoadIcon"
        LoadIcon.Size = UDim2.new(0, 48, 0, 48)
        LoadIcon.Position = UDim2.new(0.5, 0, 0.5, -25)
        LoadIcon.AnchorPoint = Vector2.new(0.5, 0.5)
        LoadIcon.BackgroundTransparency = 1
        LoadIcon.Image = "rbxassetid://114509698380342"
        LoadIcon.ZIndex = 11
        LoadIcon.Parent = LoadingFrame

        local LoadingBarBg = Instance.new("Frame")
        LoadingBarBg.Name = "LoadingBarBg"
        LoadingBarBg.Size = UDim2.new(0.6, 0, 0, 4)
        LoadingBarBg.Position = UDim2.new(0.5, 0, 0.5, 25)
        LoadingBarBg.AnchorPoint = Vector2.new(0.5, 0.5)
        LoadingBarBg.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        LoadingBarBg.ZIndex = 11
        LoadingBarBg.Parent = LoadingFrame

        local LoadingBarBgCorner = Instance.new("UICorner")
        LoadingBarBgCorner.CornerRadius = UDim.new(1, 0)
        LoadingBarBgCorner.Parent = LoadingBarBg

        local LoadingText = Instance.new("TextLabel")
        LoadingText.Text = "Initializing Framework..."
        LoadingText.Font = Enum.Font.Gotham
        LoadingText.TextColor3 = THEME.TextDim
        LoadingText.TextSize = 12
        LoadingText.BackgroundTransparency = 1
        LoadingText.Size = UDim2.new(1, 0, 0, 20)
        LoadingText.Position = UDim2.new(0, 0, 1, 5)
        LoadingText.Parent = LoadingBarBg

        local VersionLabel = Instance.new("TextLabel")
        VersionLabel.Text = "v1.2.5"
        VersionLabel.Font = Enum.Font.GothamBold
        VersionLabel.TextColor3 = Color3.fromRGB(80, 80, 80)
        VersionLabel.TextSize = 12
        VersionLabel.BackgroundTransparency = 1
        VersionLabel.Size = UDim2.new(1, 0, 0, 20)
        VersionLabel.Position = UDim2.new(0, 0, 1, -20)
        VersionLabel.Parent = LoadingFrame

        local LoadingBar = Instance.new("Frame")
        LoadingBar.Size = UDim2.new(0, 0, 1, 0)
        LoadingBar.BackgroundColor3 = THEME.Accent
        LoadingBar.ZIndex = 12
        LoadingBar.Parent = LoadingBarBg

        local LoadingBarCorner = Instance.new("UICorner")
        LoadingBarCorner.CornerRadius = UDim.new(1, 0)
        LoadingBarCorner.Parent = LoadingBar

        task.spawn(function()
            TweenService:Create(LoadingBar, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Size = UDim2.new(0.4, 0, 1, 0)}):Play()
            LoadingText.Text = "Loading Assets & Scripts..."
            task.wait(1)
            TweenService:Create(LoadingBar, TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Size = UDim2.new(0.8, 0, 1, 0)}):Play()
            LoadingText.Text = "Verifying Integrity..."
            task.wait(0.8)
            TweenService:Create(LoadingBar, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {Size = UDim2.new(1, 0, 1, 0)}):Play()
            LoadingText.Text = "Welcome!"
            task.wait(0.5)
            
            local fadeInfo = TweenInfo.new(0.5)
            TweenService:Create(LoadingFrame, fadeInfo, {BackgroundTransparency = 1}):Play()
            TweenService:Create(LoadingText, fadeInfo, {TextTransparency = 1}):Play()
            TweenService:Create(LoadIcon, fadeInfo, {ImageTransparency = 1}):Play()
            TweenService:Create(LoadingBarBg, fadeInfo, {BackgroundTransparency = 1}):Play()
            TweenService:Create(LoadingBar, fadeInfo, {BackgroundTransparency = 1}):Play()
            
            task.wait(0.5)
            LoadingFrame:Destroy()
            
            if Config.KeySystem then
                ShowKeySystem()
            else
                Window:Notification("System", "Welcome to " .. Title, 3)
            end
        end)
    end

    InitSequence()

    return Window
end

return Library
